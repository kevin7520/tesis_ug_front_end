<div class="w-full grid m-0 mt-4 mat-elevation-z4 border-round-xl p-4">
  <div class="w-full">
   <div class="w-full flex flex-wrap align-content-between">
    <p class="col color-primary tex-titulo-Serius-Game medium-bold">Nivel: {{indice+1}}</p>
    <i *ngIf="mostrarExpandible" (click)="expandible = !expandible" class="w-max col-fixed bi bi-chevron-down cursor-pointer"></i>
   </div>
   <div class="col-12 my-1">
    <div class="separate-line"></div>
   </div>
   <div class="col-6" *ngIf="expandible">
     <app-ui-kaas-input-select 
                               label="Tipo juego" 
                               hint="hint" 
                               [(value)]="nivel.opcionJuego" 
                               [options]="options_game" 
                               [id_menu]="indice+'tipo_juego'">
   
     </app-ui-kaas-input-select>
   </div>
  </div>
  <ng-container *ngIf="expandible">
    <ng-container *ngIf="agregarRequerimiento || nivel.requerimientos.length == 0">
      <div class="col-6">
        <app-ui-kaas-input-select 
                                  label="Tipo requerimiento" 
                                  hint="hint" 
                                  [(value)]="requrimientoData.opcionRequerimiento" 
                                  [options]="options_Requerimientos" 
                                  [id_menu]="indice+'requerimiento_tipo'">
    
        </app-ui-kaas-input-select>
      </div>
      <div class="col-6">
        <app-ui-kaas-input label="Requerimiento" hint="hint" [(value)]="requrimientoData.requerimiento"></app-ui-kaas-input>
      </div>
      <div class="col-6">
        <app-ui-kaas-input label="Retro Alimentación" hint="hint" placeholder="Opcional" [(value)]="requrimientoData.retroalimentacion"></app-ui-kaas-input>
      </div>
      <div class="col-6">
        <app-ui-kaas-slider label="Puntos adicionales" hint="hint" [(value)]="requrimientoData.puntosAdicionales"></app-ui-kaas-slider>
      </div>
      <div class="col-12 flex flex-grap justify-content-end">
        <div class="w-max flex gap-3 flex-grap">
          <app-ui-kaas-button *ngIf="nivel.requerimientos.length > 0"
                              [label]="''" 
                              [butonFull]="false" 
                              [icon_visible]="true"
                              [icon]="'bi bi-trash-fill'"
                              buttonSize="small"
                              tooltip="Eliminar"
                              [background_color]="'bg-red-600'"
                              (eventClick)="cancelarRegistro()">
          </app-ui-kaas-button>
          <app-ui-kaas-button [label]="''" 
                              [butonFull]="false" 
                              [icon_visible]="true"
                              [icon]="'bi bi-floppy-fill'"
                              buttonSize="small"
                              tooltip="Guardar Requerimiento"
                              [disabled]="validarGuardarRequerimiento()"
                              (eventClick)="guardarRequerimiento()">
          </app-ui-kaas-button>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="!agregarRequerimiento && nivel.requerimientos.length > 0">
      <section class="container-table" tabindex="0">
        <table mat-table [dataSource]="nivel.requerimientos">
     
          <!--- Note that these columns can be defined in any order.
                The actual rendered columns are set as a property on the row definition" -->
        
          <!-- Position Column -->
          <ng-container matColumnDef="position">
            <th mat-header-cell *matHeaderCellDef> No. </th>
            <td mat-cell *matCellDef="let element; let i = index"> {{i+1}} </td>
          </ng-container>
        
          <!-- Name Column -->
          <ng-container matColumnDef="req">
            <th mat-header-cell *matHeaderCellDef> Requerimiento </th>
            <td mat-cell *matCellDef="let element"> {{element.requerimiento}} </td>
          </ng-container>
        
          <!-- Weight Column -->
          <ng-container matColumnDef="typeReq">
            <th mat-header-cell *matHeaderCellDef> Tipo Requerimiento </th>
            <td mat-cell *matCellDef="let element"> {{element.opcionRequerimiento}} </td>
          </ng-container>
        
          <!-- Symbol Column -->
          <ng-container matColumnDef="ReqPlus">
            <th mat-header-cell *matHeaderCellDef> Retroalimentación </th>
            <td mat-cell *matCellDef="let element"> {{element.retroalimentacion}} </td>
          </ng-container>
    
          <ng-container matColumnDef="pts">
            <th mat-header-cell *matHeaderCellDef> Puntos </th>
            <td mat-cell *matCellDef="let element"> {{element.puntosAdicionales}} </td>
          </ng-container>
     
          <ng-container matColumnDef="acctions">
            <th mat-header-cell *matHeaderCellDef> Acciones </th>
            <td mat-cell *matCellDef="let element; let i = index"> 
              <i  matTooltip="Eliminar requerimiento" (click)="eliminarRequerimiento(i)" class="bi bi-trash-fill cursor-pointer"></i>
              &nbsp;&nbsp;
              <i  matTooltip="Editar requerimiento" class="bi bi-pen-fill cursor-pointer"></i>   
            </td>
          </ng-container>
        
          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </section> 
      <div class="col-12 flex flex-grap justify-content-center mt-2" *ngIf="!mostrarExpandible">
        <div class="w-max flex gap-3 flex-grap">
          <app-ui-kaas-button [label]="'Finalizar nivel' | translate" 
                              [butonFull]="false" 
                              buttonSize="small"
                              [tooltip]="nivel.requerimientos.length < 5 ? 'Debes tener minimo 5 requerimientos' : ''"
                              [disabled]="nivel.requerimientos.length < 5"
                              (eventClick)="verificarDosRequisitos()">
          </app-ui-kaas-button>
          <app-ui-kaas-button [label]="'Agregar requerimiento' | translate" 
                              [butonFull]="false" 
                              buttonSize="small"
                              (eventClick)="_agregarRequerimiento()">
          </app-ui-kaas-button>
        </div>
      </div> 
    </ng-container>
  </ng-container>
 </div>

<app-modal  [titulo]="'Finalizar juego'"  
            *ngIf="verificarFinalizar"
            [hideClose]="false"
            [peticionError]="true">
  <div app-content>
    <p>{{'Seguro que deseas finalizar el nievel, una vez finalizado no se podra editar el nivel creado'}}</p>
  </div> 
  <div app-footer>
    <div class="w-full flex flex-grap justify-content-center">
     <div class="w-max flex gap-3 flex-grap">
       <app-ui-kaas-button *ngIf="nivel.requerimientos.length > 0"
                           [label]="'Cancelar'" 
                           [butonFull]="false" 
                           buttonSize="small"
                           tooltip="Eliminar"
                           [background_color]="'bg-red-600'"
                           (eventClick)="verificarFinalizar = false">
       </app-ui-kaas-button>
       <app-ui-kaas-button class="w-full" 
                           [label]="'general.boton-aceptar' | translate" 
                           [butonFull]="true" 
                           buttonSize="small"
                           (eventClick)="finalizarNivel()">
       </app-ui-kaas-button>
     </div>
    </div>
  </div>
</app-modal>

<app-modal  [titulo]="'Requerimientos faltantes'"  
            *ngIf="verificarRequerimientos"
            [hideClose]="false"
            [peticionError]="true">
  <div app-content>
    <p>{{'Solo se agrego un tipo de requisitos y por lo menos se debe guardar dos tipos diferentes de requisitos'}}</p>
  </div> 
  <div app-footer>
    <div class="w-full flex flex-grap justify-content-center">
      <app-ui-kaas-button [label]="'general.boton-aceptar' | translate" 
                          [butonFull]="true" 
                          buttonSize="small"
                          (eventClick)="verificarRequerimientos = false">
      </app-ui-kaas-button>
    </div>
  </div>
</app-modal>

